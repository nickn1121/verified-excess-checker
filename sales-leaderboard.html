<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sales Leaderboard ‚Äì Verified Electronics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 30px;
      text-align: center;
    }
    img.logo {
      width: 180px;
      margin-bottom: 10px;
    }
    h1 {
      color: #333;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #6a0dad;
      color: white;
    }
    tr:nth-child(even) {
      background: #f2f2f2;
    }
    select, input, button {
      padding: 8px;
      margin: 5px;
    }
    .medal {
      font-size: 1.4em;
    }
    .form-container {
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border: 2px solid #6a0dad;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
    }
    .form-container h2 {
      margin-top: 0;
      color: #6a0dad;
    }
    .form-inline input, .form-inline select {
      width: 20%;
      padding: 8px;
    }
    .form-inline {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .form-inline button {
      background: #6a0dad;
      color: white;
      border: none;
      cursor: pointer;
    }
    .form-inline button:hover {
      background: #501187;
    }
  </style>
</head>
<body>
  <img class="logo" src="https://raw.githubusercontent.com/nickn1121/verified-excess-checker/3ec40a34ac5cdadcac6cf7ddccc4bd098faa4736/logo.png" alt="Verified Electronics Logo">
  <h1>üèÜ Sales Leaderboard</h1>

  <label for="filter">Filter: </label>
  <select id="filter">
    <option value="this_week">This Week</option>
    <option value="this_month">This Month</option>
    <option value="last_3_months">Last 3 Months</option>
    <option value="this_year">This Year</option>
  </select>

  <table id="leaderboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Salesperson</th>
        <th>Revenue</th>
        <th>Gross Profit</th>
        <th>Deals</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="form-container">
    <h2>Add New Deal</h2>
    <form id="dealForm" target="hidden_iframe" onsubmit="submitDeal(); return false;" class="form-inline">
      <select name="entry.1164492433" required>
        <option value="">Select Salesperson</option>
        <option value="Emir">Emir</option>
        <option value="Nick K">Nick K</option>
        <option value="Dan">Dan</option>
        <option value="Jake">Jake</option>
      </select>
      <input type="text" name="entry.716116426" placeholder="Customer" required>
      <input type="text" name="entry.839127155" placeholder="Revenue" required>
      <input type="text" name="entry.2044729058" placeholder="Gross Profit" required>
      <input type="date" name="entry.2090091395" required>
      <button type="submit">Submit Deal</button>
    </form>
    <iframe name="hidden_iframe" style="display:none;"></iframe>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/1Os4znFkZYX0HvKcsGtwcxpzJdrt0OsRHVJW2VxKZweI/gviz/tq?tqx=out:csv";

    const parseCurrency = value => {
      return parseFloat(
        value.replace(/[^0-9.,-]/g, '').replace(',', '.')
      ) || 0;
    };

    const getWeekStart = () => {
      const now = new Date();
      const day = now.getDay();
      const diff = now.getDate() - day + (day === 0 ? -6 : 1);
      return new Date(now.setDate(diff));
    };

    const getStartDate = (filter) => {
      const today = new Date();
      switch (filter) {
        case 'this_week': return getWeekStart();
        case 'this_month': return new Date(today.getFullYear(), today.getMonth(), 1);
        case 'last_3_months': return new Date(today.getFullYear(), today.getMonth() - 2, 1);
        case 'this_year': return new Date(today.getFullYear(), 0, 1);
        default: return new Date(0);
      }
    };

    function loadLeaderboard() {
      Papa.parse(SHEET_URL, {
        download: true,
        header: true,
        complete: function(results) {
          const data = results.data;
          const filter = document.getElementById("filter").value;
          const startDate = getStartDate(filter);
          const grouped = {};

          data.forEach(row => {
            const salesperson = row["Salesperson"];
            const date = new Date(row["Date"]);
            if (!salesperson || isNaN(date)) return;
            if (date < startDate) return;

            const revenue = parseCurrency(row["Revenue"]);
            const profit = parseCurrency(row["Gross Profit"]);

            if (!grouped[salesperson]) {
              grouped[salesperson] = { revenue: 0, profit: 0, deals: 0 };
            }

            grouped[salesperson].revenue += revenue;
            grouped[salesperson].profit += profit;
            grouped[salesperson].deals += 1;
          });

          const sorted = Object.entries(grouped).sort((a, b) => b[1].profit - a[1].profit);
          const tbody = document.querySelector("#leaderboard tbody");
          tbody.innerHTML = "";

          sorted.forEach(([name, stats], index) => {
            const tr = document.createElement("tr");
            const medal = index === 0 ? "ü•á" : index === 1 ? "ü•à" : index === 2 ? "ü•â" : index + 1;
            tr.innerHTML = `
              <td class="medal">${medal}</td>
              <td>${name}</td>
              <td>$${stats.revenue.toLocaleString()}</td>
              <td>$${stats.profit.toLocaleString()}</td>
              <td>${stats.deals}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      });
    }

    document.getElementById("filter").addEventListener("change", loadLeaderboard);
    window.addEventListener("load", loadLeaderboard);

    function submitDeal() {
      const form = document.getElementById("dealForm");
      const formData = new FormData(form);
      const url = "https://docs.google.com/forms/d/e/1FAIpQLScThLrSJkNo4iiJjIEGDWCaMBL6pIlLr3K58b2SSIEsr-rNFA/formResponse";
      fetch(url, { method: "POST", mode: "no-cors", body: formData }).then(() => {
        alert("Deal submitted!");
        form.reset();
        setTimeout(loadLeaderboard, 2000);
      });
    }
  </script>
</body>
</html>



